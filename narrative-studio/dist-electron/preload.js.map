{"version":3,"file":"preload.js","sources":["../electron/preload.ts"],"sourcesContent":["import { contextBridge, ipcRenderer } from 'electron';\n\n/**\n * Preload script - runs in renderer context with access to Node.js\n * Exposes a safe API to the renderer via contextBridge\n */\n\n// Types for the exposed API\nexport interface ElectronAPI {\n  // Store operations\n  store: {\n    get: (key: string) => Promise<unknown>;\n    set: (key: string, value: unknown) => Promise<boolean>;\n  };\n\n  // App info\n  getArchiveServerPort: () => Promise<number | null>;\n  getPaths: () => Promise<{\n    documents: string;\n    userData: string;\n    temp: string;\n    logs: string;\n    home: string;\n  }>;\n  isFirstRun: () => Promise<boolean>;\n  completeFirstRun: () => Promise<boolean>;\n  getPlatformInfo: () => Promise<{\n    platform: NodeJS.Platform;\n    arch: string;\n    version: string;\n    isPackaged: boolean;\n  }>;\n\n  // Archive management\n  getArchivePath: () => Promise<string | null>;\n  restartArchiveServer: (newPath: string) => Promise<{ success: boolean; port?: number; error?: string }>;\n\n  // File dialogs\n  selectFolder: () => Promise<string | null>;\n  selectArchive: () => Promise<string | null>;\n  getDiskSpace: (path: string) => Promise<{ free: number; total: number }>;\n\n  // Ollama operations\n  ollama: {\n    getStatus: () => Promise<OllamaStatus>;\n    startServer: () => Promise<boolean>;\n    stopServer: () => Promise<boolean>;\n    pullModel: (name: string, onProgress?: (progress: number) => void) => Promise<boolean>;\n    listModels: () => Promise<OllamaModel[]>;\n  };\n\n  // Event listeners\n  onArchiveServerReady: (callback: (port: number) => void) => void;\n  onOllamaProgress: (callback: (progress: OllamaProgress) => void) => void;\n  removeAllListeners: (channel: string) => void;\n}\n\nexport interface OllamaStatus {\n  installed: boolean;\n  running: boolean;\n  version?: string;\n  endpoint: string;\n}\n\nexport interface OllamaModel {\n  name: string;\n  size: number;\n  modified: string;\n  digest: string;\n}\n\nexport interface OllamaProgress {\n  model: string;\n  status: string;\n  completed: number;\n  total: number;\n  percent: number;\n}\n\n// Expose protected methods to renderer\ncontextBridge.exposeInMainWorld('electronAPI', {\n  // Store operations\n  store: {\n    get: (key: string) => ipcRenderer.invoke('store-get', key),\n    set: (key: string, value: unknown) => ipcRenderer.invoke('store-set', key, value)\n  },\n\n  // App info\n  getArchiveServerPort: () => ipcRenderer.invoke('get-archive-server-port'),\n  getPaths: () => ipcRenderer.invoke('get-paths'),\n  isFirstRun: () => ipcRenderer.invoke('is-first-run'),\n  completeFirstRun: () => ipcRenderer.invoke('complete-first-run'),\n  getPlatformInfo: () => ipcRenderer.invoke('get-platform-info'),\n\n  // Archive management\n  getArchivePath: () => ipcRenderer.invoke('get-archive-path'),\n  restartArchiveServer: (newPath: string) => ipcRenderer.invoke('restart-archive-server', newPath),\n\n  // File dialogs\n  selectFolder: () => ipcRenderer.invoke('select-folder'),\n  selectArchive: () => ipcRenderer.invoke('select-archive'),\n  getDiskSpace: (path: string) => ipcRenderer.invoke('get-disk-space', path),\n\n  // Ollama operations\n  ollama: {\n    getStatus: () => ipcRenderer.invoke('ollama-status'),\n    startServer: () => ipcRenderer.invoke('ollama-start'),\n    stopServer: () => ipcRenderer.invoke('ollama-stop'),\n    pullModel: (name: string) => ipcRenderer.invoke('ollama-pull', name),\n    listModels: () => ipcRenderer.invoke('ollama-list-models')\n  },\n\n  // Event listeners\n  onArchiveServerReady: (callback: (port: number) => void) => {\n    ipcRenderer.on('archive-server-ready', (_event, port) => callback(port));\n  },\n  onOllamaProgress: (callback: (progress: OllamaProgress) => void) => {\n    ipcRenderer.on('ollama-progress', (_event, progress) => callback(progress));\n  },\n  removeAllListeners: (channel: string) => {\n    ipcRenderer.removeAllListeners(channel);\n  }\n} as ElectronAPI);\n\n// Also expose a way to check if running in Electron\ncontextBridge.exposeInMainWorld('isElectron', true);\n"],"names":["contextBridge","key","ipcRenderer","value","newPath","path","name","callback","_event","port","progress","channel"],"mappings":";AAgFAA,EAAc,kBAAkB,eAAe;AAAA;AAAA,EAE7C,OAAO;AAAA,IACL,KAAK,CAACC,MAAgBC,EAAY,OAAO,aAAaD,CAAG;AAAA,IACzD,KAAK,CAACA,GAAaE,MAAmBD,EAAY,OAAO,aAAaD,GAAKE,CAAK;AAAA,EAAA;AAAA;AAAA,EAIlF,sBAAsB,MAAMD,EAAY,OAAO,yBAAyB;AAAA,EACxE,UAAU,MAAMA,EAAY,OAAO,WAAW;AAAA,EAC9C,YAAY,MAAMA,EAAY,OAAO,cAAc;AAAA,EACnD,kBAAkB,MAAMA,EAAY,OAAO,oBAAoB;AAAA,EAC/D,iBAAiB,MAAMA,EAAY,OAAO,mBAAmB;AAAA;AAAA,EAG7D,gBAAgB,MAAMA,EAAY,OAAO,kBAAkB;AAAA,EAC3D,sBAAsB,CAACE,MAAoBF,EAAY,OAAO,0BAA0BE,CAAO;AAAA;AAAA,EAG/F,cAAc,MAAMF,EAAY,OAAO,eAAe;AAAA,EACtD,eAAe,MAAMA,EAAY,OAAO,gBAAgB;AAAA,EACxD,cAAc,CAACG,MAAiBH,EAAY,OAAO,kBAAkBG,CAAI;AAAA;AAAA,EAGzE,QAAQ;AAAA,IACN,WAAW,MAAMH,EAAY,OAAO,eAAe;AAAA,IACnD,aAAa,MAAMA,EAAY,OAAO,cAAc;AAAA,IACpD,YAAY,MAAMA,EAAY,OAAO,aAAa;AAAA,IAClD,WAAW,CAACI,MAAiBJ,EAAY,OAAO,eAAeI,CAAI;AAAA,IACnE,YAAY,MAAMJ,EAAY,OAAO,oBAAoB;AAAA,EAAA;AAAA;AAAA,EAI3D,sBAAsB,CAACK,MAAqC;AAC1D,IAAAL,EAAY,GAAG,wBAAwB,CAACM,GAAQC,MAASF,EAASE,CAAI,CAAC;AAAA,EACzE;AAAA,EACA,kBAAkB,CAACF,MAAiD;AAClE,IAAAL,EAAY,GAAG,mBAAmB,CAACM,GAAQE,MAAaH,EAASG,CAAQ,CAAC;AAAA,EAC5E;AAAA,EACA,oBAAoB,CAACC,MAAoB;AACvC,IAAAT,EAAY,mBAAmBS,CAAO;AAAA,EACxC;AACF,CAAgB;AAGhBX,EAAc,kBAAkB,cAAc,EAAI;"}