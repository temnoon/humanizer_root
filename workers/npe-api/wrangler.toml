name = "npe-api"
main = "src/index.ts"
compatibility_date = "2025-09-01"
compatibility_flags = ["nodejs_compat"]

# Keep workers.dev URL active during transition to custom domain
workers_dev = true

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "npe-production-db"
database_id = "29127486-4246-44b2-a844-7bbeb44f75fb"

# AI Model Binding
[ai]
binding = "AI"

# KV for rate limiting and sessions
[[kv_namespaces]]
binding = "KV"
id = "4c372f27384b40d1aa02aed7be7c8ccd"

# R2 for encrypted file storage
[[r2_buckets]]
binding = "R2_ARCHIVE"
bucket_name = "humanizer-archive"

# Durable Objects for maieutic dialogue sessions
[[durable_objects.bindings]]
name = "MAIEUTIC_SESSION"
class_name = "MaieuticSessionDO"
script_name = "npe-api"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["MaieuticSessionDO"]

# Environment variables
[vars]
ENVIRONMENT = "production"

# Local development overrides
# When running `wrangler dev --local`, use development environment
# This enables registration for local API distribution and testing
[env.dev]
vars = { ENVIRONMENT = "development" }

# Custom domain routes
# Note: DNS must be configured in Cloudflare dashboard first
[[routes]]
pattern = "npe-api.humanizer.com/*"
zone_name = "humanizer.com"

# Secrets (set via wrangler secret put)
# JWT_SECRET - set via: wrangler secret put JWT_SECRET
# STRIPE_SECRET_KEY - set via: wrangler secret put STRIPE_SECRET_KEY
# STRIPE_WEBHOOK_SECRET - set via: wrangler secret put STRIPE_WEBHOOK_SECRET
# GOOGLE_CLIENT_SECRET - Google OAuth
# GITHUB_CLIENT_SECRET - GitHub OAuth
# DISCORD_CLIENT_SECRET - Discord OAuth
# (Apple/Facebook configured post-launch)
